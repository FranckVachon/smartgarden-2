import java.util.Random

rule "Initialiser les lumières"
when
    System started
then
    logError("jardin.rules", "FUCK FUCK FUCK FUCK")
end



/**
 * initialiser divers états de nos items .
 */

 // lumières: initialisées fermées
rule "Initialiser les lumières"
when
    System started
then

    logError("jardin.rules", "FUCK FUCK FUCK FUCK")
    lumieres?.members.forEach(lum|
        postUpdate(lum, OFF)
    )
end


 // verrous: initialisées verrouillés (ON)
rule "Initialiser les verrous"
when
    System started
then
    logError("jardin.rules", "FUCK FUCK FUCK FUCK")
    verrous?.members.forEach(verrou|
        postUpdate(verrou, ON)
    )
end

 // verrous: initialisées verrouillés (ON)
rule "Initialiser les thermostats"
when
    System started
then

    verrous?.members.forEach(verrou|
        postUpdate(verrou, ON)
    )
end

rule "Initialiser les températures aléatoires"
when
    System started
then
    logInfo("Info", "Initialiser les températures aléatoires")
    gTemperature.members.forEach(temperature|
        postUpdate(temperature, 17.5 ))
end

rule "Initialiser les températures  - controllers"
when
    System started
then
    gThermostat.members.forEach(thermo|
        postUpdate(thermo,22)
    )
end



//  Exemple de règle avec MQTT - publier sur un update d'item
rule "Mqtt - publish to topic on item action"
when    
    Item verrous_piscine received update
then
    logInfo("jardin.rules", "mqtt test ping rule script... ")

    // must match: Bridge mqtt:broker:mosquitto [ host="0.0.0.0", secure=false ] in jardin.things
    val mqttActions = getActions("mqtt", "mqtt:broker:mosquitto")
    mqttActions.publishMQTT("test", "This is the switch speaking")
end

// Exemple de règles mqtt - update un item par un publish sur un topic
rule "mqtt topic updates an item state"
when
    // again, mqtt:broker:mosquitto must match the broker defined in things.
    Channel "mqtt:broker:mosquitto:mything" triggered
then
    logInfo("jardin.rules", "mqtt - updating an item from a topic ")
    lumieres?.members.forEach(lum| postUpdate(lum, OFF) )

end


rule "Receive all"
when 
      Channel "mqtt:broker:mosquitto" triggered
then 
    logInfo("jardin.rules", "mqtt triggered from client ")
end


